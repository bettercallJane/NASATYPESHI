<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Flare: Space Weather Story (MVP)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  html,body { margin:0; padding:0; height:100%; overflow:hidden; font-family:Inter, Arial, sans-serif; }
  #container { width:100%; height:100%; position:relative; background:#000; }
  #overlay {
    position:absolute; left:16px; top:16px; width:340px; max-width:40%;
    background:rgba(255,255,255,0.95); padding:12px; border-radius:10px;
    box-shadow:0 6px 20px rgba(0,0,0,0.4); z-index:5;
  }
  #title { font-weight:700; font-size:18px; margin-bottom:6px; }
  #text { font-size:14px; line-height:1.3; color:#111; min-height:62px; }
  .controls { margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; }
  button { padding:8px 10px; border-radius:8px; border:0; background:#0b74de; color:#fff; cursor:pointer; font-weight:600; }
  button.secondary { background:#666; }
  .small { padding:6px 8px; font-size:13px; }
  .cards { margin-top:10px; display:flex; gap:8px; }
  .card { background:#f6f8fb; padding:8px; border-radius:8px; cursor:pointer; flex:1; text-align:center; font-size:13px; }
  .card.active { outline:3px solid #ffd54d; background:#fffbe6; }
  #footer { position:absolute; right:16px; bottom:16px; z-index:6; color:#fff; font-size:13px; background:rgba(0,0,0,0.4); padding:8px 10px; border-radius:8px; }
  #quiz { margin-top:10px; }
  #finish { display:none; padding:10px; background:#e8f7ff; border-radius:8px; margin-top:8px; }
  /* responsive adjustments */
  @media (max-width:900px){
    #overlay{ width:86%; max-width:none; left:7%; top:10px; }
    .cards{ flex-direction:row; }
  }
</style>
</head>
<body>
<div id="container"></div>

<div id="overlay">
  <div id="title">Flare: Space Weather Story</div>
  <div id="text">üåû Meet <b>Flare</b>, a curious solar spark. Click <b>Launch</b> to send Flare toward Earth and explore how space weather affects people.</div>

  <div class="controls">
    <button id="launchBtn">Launch</button>
    <button id="nextBtn" class="secondary small" disabled>Next</button>
    <button id="resetBtn" class="secondary small">Reset</button>
  </div>

  <div style="margin-top:10px; font-weight:600; font-size:13px;">Explore perspectives</div>
  <div class="cards">
    <div class="card" id="astronaut">Astronaut üë©‚ÄçüöÄ</div>
    <div class="card" id="pilot">Pilot ‚úàÔ∏è</div>
    <div class="card" id="farmer">Farmer üöú</div>
  </div>

  <div id="impact" style="margin-top:10px; font-size:13px; min-height:56px;">
    Click a role above to see how space weather could impact them.
  </div>

  <div id="quiz" style="margin-top:8px;">
    <div style="font-weight:700; font-size:13px;">Quick quiz</div>
    <div style="font-size:13px; margin-top:6px;">What beautiful phenomenon can a solar storm create near Earth's poles?</div>
    <div style="margin-top:6px;">
      <button class="small" data-answer="a">Rainbows</button>
      <button class="small" data-answer="b">Auroras</button>
      <button class="small" data-answer="c">Lightning</button>
    </div>
    <div id="quizResult" style="margin-top:8px; font-weight:600;"></div>
  </div>

  <div id="finish">Congrats ‚Äî ready to demo! Use the 2-minute pitch: "Flare explains space weather..."</div>
</div>

<div id="footer">Use Chrome/Firefox. For local debugging: run <code>python -m http.server</code> (optional)</div>

<!-- Three.js from CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>


// ====== Scene setup ======
const container = document.getElementById('container');
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x030417); // deep space

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 8, 70);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
container.appendChild(renderer.domElement);

// lighting
const hemi = new THREE.HemisphereLight(0xffffff, 0x000000, 0.6);
scene.add(hemi);
const pointLight = new THREE.PointLight(0xffffff, 1.2, 400);
pointLight.position.set(-20, 20, 40);
scene.add(pointLight);

// ====== Objects ======
// Sun (emissive)
const sunGeo = new THREE.SphereGeometry(6, 32, 32);
const sunMat = new THREE.MeshBasicMaterial({ color: 0xFDB813 });
const sun = new THREE.Mesh(sunGeo, sunMat);
sun.position.set(-40, 0, 0);
scene.add(sun);

// Earth
const earthGeo = new THREE.SphereGeometry(5, 48, 48);
const earthMat = new THREE.MeshStandardMaterial({ color: 0x2b63d6, roughness:0.7, metalness:0.0 });
const earth = new THREE.Mesh(earthGeo, earthMat);
earth.position.set(0, 0, 0);
scene.add(earth);

// simple cloud/glow layer (subtle)
const cloudGeo = new THREE.SphereGeometry(5.2, 48, 48);
const cloudMat = new THREE.MeshLambertMaterial({ color:0xffffff, transparent:true, opacity:0.02 });
const cloud = new THREE.Mesh(cloudGeo, cloudMat);
cloud.position.copy(earth.position);
scene.add(cloud);

// ISS (small box) orbit group
const issGroup = new THREE.Group();
scene.add(issGroup);
const iss = new THREE.Mesh(new THREE.BoxGeometry(1.2,0.6,0.4), new THREE.MeshStandardMaterial({color:0xcccccc}));
iss.position.set(0,0,0);
issGroup.add(iss);
issGroup.position.copy(earth.position);

// Aurora ring (invisible initially)
const auroraGeo = new THREE.RingGeometry(6.2, 8, 64);
const auroraMat = new THREE.MeshBasicMaterial({ color:0x6cf28c, transparent:true, opacity:0.0, side:THREE.DoubleSide });
const aurora = new THREE.Mesh(auroraGeo, auroraMat);
aurora.rotation.x = Math.PI/2;
aurora.position.copy(earth.position);
aurora.visible = false;
scene.add(aurora);

// Flare (a glowing sphere + simple emissive)
const flareGeo = new THREE.SphereGeometry(0.9, 16, 16);
const flareMat = new THREE.MeshBasicMaterial({ color: 0xff6b2f });
const flare = new THREE.Mesh(flareGeo, flareMat);
flare.position.set(-40, 0, 0);
scene.add(flare);

// subtle trail (particles) for flare - small, simple implementation
const trailCount = 40;
const trailGeo = new THREE.BufferGeometry();
const trailPositions = new Float32Array(trailCount * 3);
trailGeo.setAttribute('position', new THREE.BufferAttribute(trailPositions, 3));
const trailMat = new THREE.PointsMaterial({ color:0xff8a50, size:0.18, transparent:true, opacity:0.7 });
const trail = new THREE.Points(trailGeo, trailMat);
scene.add(trail);



// ====== Story & interaction state ======
let stage = 0; // 0 = ready, 1=launching, 2=atISS, 3=aurora, 4=returning, 5=end
let animating = false;
let nextAllowed = false;
let issAngle = 0;

// UI elements
const textEl = document.getElementById('text');
const launchBtn = document.getElementById('launchBtn');
const nextBtn = document.getElementById('nextBtn');
const resetBtn = document.getElementById('resetBtn');
const impactEl = document.getElementById('impact');
const astronautCard = document.getElementById('astronaut');
const pilotCard = document.getElementById('pilot');
const farmerCard = document.getElementById('farmer');
const finishEl = document.getElementById('finish');
const quizResult = document.getElementById('quizResult');

// role card content
const roleInfo = {
  astronaut: "<b>Astronaut:</b> Space weather can make the astronaut's radios and navigation systems noisy ‚Äî scientists monitor storms so crews are safe.",
  pilot: "<b>Pilot:</b> Solar storms can affect GPS signals for planes and radios. Airlines may change routes to avoid disturbances at high latitudes.",
  farmer: "<b>Farmer:</b> Farmers using GPS-guided tractors or satellite data for planting may see errors when space weather disrupts signals."
};

// card clicks
[astronautCard, pilotCard, farmerCard].forEach(el=>{
  el.addEventListener('click', e=>{
    [astronautCard,pilotCard,farmerCard].forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
    const id = el.id;
    impactEl.innerHTML = roleInfo[id];
  });
});

// quiz buttons
document.querySelectorAll('#quiz button').forEach(btn=>{
  btn.addEventListener('click', e=>{
    const a = e.target.getAttribute('data-answer');
    if(a === 'b'){ quizResult.innerText = "‚úÖ Correct ‚Äî auroras!"; quizResult.style.color = "green"; }
    else { quizResult.innerText = "‚ùå Not quite ‚Äî try again!"; quizResult.style.color = "crimson"; }
    finishEl.style.display = "block";
  });
});

// ====== Button behavior ======
launchBtn.addEventListener('click', ()=> {
  if(stage !== 0 && stage !== 5) return; // only allowed at ready/end
  stage = 1;
  textEl.innerText = "üöÄ Flare launches from the Sun toward Earth!";
  animating = true;
  nextAllowed = false;
  nextBtn.disabled = true;
  launchBtn.disabled = true;
  finishEl.style.display = "none";
});

nextBtn.addEventListener('click', ()=>{
  if(!nextAllowed) return;
  // advance scene
  if(stage === 1){ stage = 2; textEl.innerText = "üõ∞Ô∏è Flare near the International Space Station (ISS). Click a role to see impact."; nextAllowed = true; nextBtn.disabled = false; }
  else if(stage === 2){ stage = 3; textEl.innerText = "üåå Flare's particles interact with Earth's magnetic field ‚Äî auroras appear!"; aurora.visible = true; nextAllowed = true; nextBtn.disabled = false; }
  else if(stage === 3){ stage = 4; textEl.innerText = "‚Ü©Ô∏è Flare returns to the Sun. Reset to play again."; animating = true; nextAllowed = false; nextBtn.disabled = true; }
  else { /* nothing */ }
});

resetBtn.addEventListener('click', resetAll);

// ====== Animation loop ======
const clock = new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);
  const dt = clock.getDelta();

  // ISS orbit
  issAngle += dt * 0.8; // speed
  const r = 9; // orbit radius
  issGroup.position.set(earth.position.x, earth.position.y, earth.position.z);
  iss.position.set(r*Math.cos(issAngle), 2.6, r*Math.sin(issAngle));

  // Earth subtle rotation and cloud
  earth.rotation.y += dt * 0.05;
  cloud.rotation.y += dt * 0.06;

  // trail logic: simple trail particles that follow flare
  for(let i=0;i<trailCount;i++){
    const t = (i / trailCount) * 6; // older particles further behind
    const px = flare.position.x + t*0.6; // trailing along x
    trailPositions[i*3+0] = px;
    trailPositions[i*3+1] = flare.position.y + Math.sin((Date.now()/200)+i)*0.06;
    trailPositions[i*3+2] = flare.position.z + 0.02*i;
  }
  trailGeo.attributes.position.needsUpdate = true;

  // story animations
  if(animating){
    if(stage === 1){
      // flare moves from Sun (-40) to Earth (0)
      if(flare.position.x < 0){
        flare.position.x += 0.6; // speed control
        // when close to ISS, notify
        const distToISS = flare.position.distanceTo(iss.position);
        if(distToISS < 6){
          textEl.innerText = "üõ∞Ô∏è Flare passes near the ISS ‚Äî radios may be noisy!";
        }
      } else {
        flare.position.x = 0;
        animating = false;
        nextAllowed = true;
        nextBtn.disabled = false;
        launchBtn.disabled = true; // keep launch disabled while mid-run
        textEl.innerText = "üõ∞Ô∏è Flare passed the ISS! Click Next to see auroras.";
      }
    } else if(stage === 4){
      // return to Sun
      if(flare.position.x > -40){
        flare.position.x -= 0.9;
      } else {
        // done
        animating = false;
        stage = 5; // ended
        nextAllowed = false;
        nextBtn.disabled = true;
        launchBtn.disabled = false;
        textEl.innerText = "üåû Flare is back on the Sun. You can Reset or Launch again.";
      }
    }
  }

  // aurora animation (pulsing)
  if(aurora.visible){
    aurora.material.opacity = 0.35 + 0.15*Math.sin(Date.now()/300);
    aurora.rotation.z += 0.003;
    // color pulse
    const t = (Date.now()%2000)/2000;
    aurora.material.color.setHSL(0.35 + 0.05*Math.sin(t*Math.PI*2), 0.8, 0.5);
  }

  renderer.render(scene, camera);
}
animate();

// ====== Helpers ======
function resetAll(){
  stage = 0;
  animating = false;
  nextAllowed = false;
  nextBtn.disabled = true;
  launchBtn.disabled = false;
  textEl.innerText = "üåû Meet Flare, a curious solar spark. Click Launch to begin.";
  flare.position.set(-40,0,0);
  aurora.visible = false;
  aurora.material.opacity = 0.0;
  [astronautCard,pilotCard,farmerCard].forEach(c=>c.classList.remove('active'));
  impactEl.innerHTML = "Click a role above to see how space weather could impact them.";
  quizResult.innerText = "";
  finishEl.style.display = "none";
}

// ensure initial UI state
resetAll();

// resize handling
window.addEventListener('resize', ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
